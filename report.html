
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NSSC1 Numerical Methods for Ordinary Differential Equations Exercises &#8212; ASC-ODE</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'report';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/ASC_Logo_transparent_300ppi_RGB.png" class="logo__image only-light" alt="ASC-ODE - Home"/>
    <script>document.write(`<img src="_static/ASC_Logo_transparent_300ppi_RGB.png" class="logo__image only-dark" alt="ASC-ODE - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    NSSC1 Numerical Methods for Ordinary Differential Equations Exercises
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/e11717655/ASC-ODE-Team13" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/report.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>NSSC1 Numerical Methods for Ordinary Differential Equations Exercises</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">NSSC1 Numerical Methods for Ordinary Differential Equations Exercises</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-euler-method">Explicit Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-euler-method">Implicit Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-euler-method">Improved Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#crank-nicolson-method">Crank-Nicolson Method</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-plots">Interpretation of Plots</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#nssc1-numerical-methods-for-ordinary-differential-equations-exercises-part-2">NSSC1 Numerical Methods for Ordinary Differential Equations Exercises Part 2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-report-electric-network-simulation">Exercise Report: Electric Network Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathematical-model">1. Mathematical Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-to-autonomous-form">2. Transformation to Autonomous Form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jacobian-for-implicit-methods">3. Jacobian for Implicit Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">4. Setup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-simulation-results">Analysis of Simulation Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-r-100-c-10-6">Part 1: (<span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-system-r-1-c-1">Part 2: System (<span class="math notranslate nohighlight">\(R=1, C=1\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-methods">Comparison of Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-comparison">Summary Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">Code</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-18-4">Exercise 18.4</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subtraction">Subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#division">Division</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-autodiff-functions">Additional AutoDiff Functions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#square">Square</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#square-root">Square Root</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cosine">Cosine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tangent">Tangent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logarithm">Logarithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential">Exponential</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#legendre-polynomials">Legendre Polynomials</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-of-the-autodiff-class-for-the-pendulum">Testing of the AutoDiff Class for the Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1. Mathematical Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2. Transformation to Autonomous Form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-differentiation">3. Automatic Differentiation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">4. Testing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">5. Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#runge-kutta-methods">Runge Kutta Methods</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-19-4">Exercise 19.4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-of-implicit-runge-kutta-methods">Testing of Implicit Runge-Kutta Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#graphs">Graphs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-explicit-runge-kutta-method">Implementation of Explicit Runge-Kutta Method</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Graphs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-20-4-1-mass-spring-system">Exercise 20.4.1 Mass-spring system</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#original-mathematical-model">1. Original Mathematical Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-state">System State</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forces">Forces</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gravity">Gravity:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-forces">Spring Forces:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equations-of-motion-unconstrained">Equations of Motion (Unconstrained)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-constraints">2. Adding Constraints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-distance-constraint">Example: Distance Constraint</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saddle-point-system-for-ddot-x-and-lambda">3. Saddle-Point System for <span class="math notranslate nohighlight">\(\ddot{x}\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytic-derivative-of-acceleration">4. Analytic Derivative of Acceleration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-contribution-k-text-spring">4.1 Spring Contribution (<span class="math notranslate nohighlight">\(K_\text{spring}\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unconstrained-case">4.2 Unconstrained Case</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constrained-case">4.3 Constrained Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#double-pendulum">Double Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-pendulum-with-the-constraint-based-formulation">Double Pendulum with the constraint-based formulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chain-pendulum">Chain Pendulum</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crane">Crane</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spinning-top">Spinning Top</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nssc1-numerical-methods-for-ordinary-differential-equations-exercises">
<h1>NSSC1 Numerical Methods for Ordinary Differential Equations Exercises<a class="headerlink" href="#nssc1-numerical-methods-for-ordinary-differential-equations-exercises" title="Link to this heading">#</a></h1>
<p>For this exercise, we compared several different time-stepping methods for a mass attached to a spring, this is described by the ODE:</p>
<div class="math notranslate nohighlight">
\[m y''(t) = -k y(t)\]</div>
<p>giving us a simple harmonic oscilator system, with <span class="math notranslate nohighlight">\(k\)</span> as the spring constant, <span class="math notranslate nohighlight">\(m\)</span> as the mass, and <span class="math notranslate nohighlight">\(y(t)\)</span> as displacement.
This second-order equation can be replaced with the first order system:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
y_{0}^{\prime} = y_{1} \\
y_{1}^{\prime} = - \frac{k}{m} y_{0}
\end{split}\]</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MassSpring</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NonlinearFunction</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">m_mass</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">m_stiffness</span><span class="p">;</span>
<span class="w">  </span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">MassSpring</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_mass</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">m_stiffness</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimX</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimF</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluate</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">m_stiffness</span><span class="o">/</span><span class="n">m_mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluateDeriv</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">MatrixView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">m_stiffness</span><span class="o">/</span><span class="n">m_mass</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Once this system has been set up they can be solved using various timestep methods.</p>
<p>These methods are implemented by modifying the base class <code class="docutils literal notranslate"><span class="pre">TimeStepper</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TimeStepper</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">protected</span><span class="o">:</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_rhs</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">TimeStepper</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_rhs</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">TimeStepper</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doStep</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="explicit-euler-method">
<h1>Explicit Euler Method<a class="headerlink" href="#explicit-euler-method" title="Link to this heading">#</a></h1>
<p>The first time step method is the Explicit Euler Method. It is an explicit, one-step method where the ODE</p>
<div class="math notranslate nohighlight">
\[
y^{\prime}(t) = f(y(t)) \quad \forall t \in [0,T], \quad y(0) = y_{0}
\]</div>
<p>is solved by using this method:</p>
<div class="math notranslate nohighlight">
\[
y_{i+1} = y_{i} + \tau f(y_{i}) \quad \text{for } 0 \leq i &lt; n
\]</div>
<p>with <span class="math notranslate nohighlight">\(\tau = T/n\)</span>. The error of this method is proptional to the step size, making it have first order accuracy <span class="math notranslate nohighlight">\(O(\tau)\)</span>. The method is only conditionally stable, and when utilized for a pure harmonic oscilator, as it was in this case, it is not stable as energy is added to the system causing the amplitude of the oscillations to increase.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">ExplicitEuler</span></code> looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ExplicitEuler</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TimeStepper</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Vector</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">ExplicitEuler</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">TimeStepper</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimF</span><span class="p">())</span><span class="w"> </span><span class="p">{}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">doStep</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m_rhs</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">);</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tau</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Here the base class is updated by modifying the <code class="docutils literal notranslate"><span class="pre">doStep</span></code> function. It now takes <code class="docutils literal notranslate"><span class="pre">tau</span></code> and <code class="docutils literal notranslate"><span class="pre">m_vectf</span></code> as inputs and then updates the state vector by adding them.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="implicit-euler-method">
<h1>Implicit Euler Method<a class="headerlink" href="#implicit-euler-method" title="Link to this heading">#</a></h1>
<p>Next up, we had to try out the Implicit Euler Method. Compared to the explicit Euler method, the implicit Euler Method is more computationally expensive, due to it having to solve a potentially nonlinear equation for <span class="math notranslate nohighlight">\(y_i+1\)</span>. This is done using a built in Newton Solver. The method is also first-order accurate, with the error decreasing linearly with step size <span class="math notranslate nohighlight">\(\tau\)</span>. However, this method is both A-stable and L-stable. It has a dampening effect built in which causes the oscillations to decay over time, despite not having any friction defined in the system.</p>
<p>The Method is defined by</p>
<div class="math notranslate nohighlight">
\[
\frac{y_{i+1} - y_i}{t_{i+1} - t_i} = f(t_{i+1}, y_{i+1})
\]</div>
<p>or it can be rewritten as</p>
<div class="math notranslate nohighlight">
\[
y_{i+1} = y_i + \tau\, f(t_{i+1}, y_{i+1}), \qquad 0 \le i &lt; n
\]</div>
<p>The code was already provided. The implementation utilized was</p>
<div class="math notranslate nohighlight">
\[
y - y_{old} - τf(y) = 0
\]</div>
<p>with the provided class</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ImplicitEuler</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TimeStepper</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_equ</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Parameter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_tau</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_yold</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">ImplicitEuler</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">TimeStepper</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span><span class="w"> </span><span class="n">m_tau</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_yold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">());</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">ynew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">IdentityFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">());</span>
<span class="w">      </span><span class="n">m_equ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ynew</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m_yold</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m_tau</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_rhs</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DoStep</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_yold</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_tau</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">tau</span><span class="p">);</span>
<span class="w">      </span><span class="n">NewtonSolver</span><span class="p">(</span><span class="n">m_equ</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="improved-euler-method">
<h1>Improved Euler Method<a class="headerlink" href="#improved-euler-method" title="Link to this heading">#</a></h1>
<p>This method involved modifying the <code class="docutils literal notranslate"><span class="pre">ExplicitEuler</span></code> time-stepping method by replacing the time steps with</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\tilde{y} = y _n + \frac{τ}{2}f(y_n) \\
y_{n+1} = y_{n} + τf(\tilde{y})
\end{split}\]</div>
<p>This method is also explicit, however it is second-order <span class="math notranslate nohighlight">\(O(τ^{2}))\)</span> accurate, causing the error to decrease in proportion to the square of the timestep. It is still not stable, and also does not need a <code class="docutils literal notranslate"><span class="pre">NewtonSolver</span></code> as it only requires two function evaluations.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ImprovedEuler</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TimeStepper</span><span class="p">{</span>
<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">;</span>
<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">halfway</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">ImprovedEuler</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">TimeStepper</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimF</span><span class="p">()),</span><span class="w"> </span><span class="n">halfway</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">())</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DoStep</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m_rhs</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">);</span>
<span class="w">      </span><span class="n">halfway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">      </span><span class="n">halfway</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">tau</span><span class="p">)</span><span class="o">*</span><span class="n">m_vecf</span><span class="p">;</span>

<span class="w">      </span><span class="n">m_rhs</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">halfway</span><span class="p">,</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">);</span>
<span class="w">      </span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tau</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_vecf</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="crank-nicolson-method">
<h1>Crank-Nicolson Method<a class="headerlink" href="#crank-nicolson-method" title="Link to this heading">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">CrankNicolson</span></code> class was implemented by modifying the <code class="docutils literal notranslate"><span class="pre">ImplicitEuler</span></code> class. They both rely on the <code class="docutils literal notranslate"><span class="pre">NewtonStepper</span></code> as they are implicit methods, the difference however, is in the way the steps are calculated</p>
<div class="math notranslate nohighlight">
\[
y_{i+1} = y_i + \frac{τ}{2}(f(t_i, y_i) + f(t_{i+1}, y_{i+1}) \qquad 0 \le i &lt; n
\]</div>
<p>This method is a one-step method. It utilizes the trapezoidal integration rule for the formulation of the steps and has second-order accuracy. It is A-stable, and unlike the implicit Euler Method it is energy conserving, meaning that the oscillations will continue without decay or explostion (Explicit Euler).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CrankNicolson</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">TimeStepper</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_equ</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Parameter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_tau</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_yold</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_f_old</span><span class="p">;</span>

<span class="w">  </span><span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">CrankNicolson</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NonlinearFunction</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">TimeStepper</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span><span class="w"> </span><span class="n">m_tau</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_yold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">());</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">ynew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">IdentityFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">());</span>
<span class="w">      </span><span class="n">m_fold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ConstantFunction</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="o">-&gt;</span><span class="n">dimX</span><span class="p">());</span>
<span class="w">      </span><span class="n">m_equ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ynew</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">m_yold</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">m_tau</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">m_rhs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m_fold</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">DoStep</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tau</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fy_val</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">      </span><span class="n">m_rhs</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">fy_val</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="n">m_fold</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">fy_val</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_yold</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w">       </span>
<span class="w">      </span><span class="n">m_tau</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="n">tau</span><span class="p">);</span><span class="w">      </span>

<span class="w">      </span><span class="n">NewtonSolver</span><span class="p">(</span><span class="n">m_equ</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>
</div>
<section id="interpretation-of-plots">
<h2>Interpretation of Plots<a class="headerlink" href="#interpretation-of-plots" title="Link to this heading">#</a></h2>
<p>10 Steps</p>
<p><a class="reference internal" href="_images/phase_plot_10_12.57.png"><img alt="_images/phase_plot_10_12.57.png" src="_images/phase_plot_10_12.57.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10_12.57.png"><img alt="_images/time_evo_10_12.57.png" src="_images/time_evo_10_12.57.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10 steps, end time 12.57.</p>
<p><a class="reference internal" href="_images/phase_plot_10_62.83.png"><img alt="_images/phase_plot_10_62.83.png" src="_images/phase_plot_10_62.83.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10_62.83.png"><img alt="_images/time_evo_10_62.83.png" src="_images/time_evo_10_62.83.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10 steps, end time 62.83.</p>
<p><a class="reference internal" href="_images/phase_plot_10_314.16.png"><img alt="_images/phase_plot_10_314.16.png" src="_images/phase_plot_10_314.16.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10_314.16.png"><img alt="_images/time_evo_10_314.16.png" src="_images/time_evo_10_314.16.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10 steps, end time 314.16.</p>
<ol class="arabic simple">
<li><p><strong>Large step sizes (τ = 10)</strong><br />
For large time steps, the numerical method introduces significant deformation in the phase plot.<br />
The the phase plots become heavily distorted, showing numerical damping or energy increase.
It is a direct consequence of the low resolution of the discretization and instability of the method.</p></li>
</ol>
<p>100 Steps</p>
<p><a class="reference internal" href="_images/phase_plot_100_12.57.png"><img alt="_images/phase_plot_100_12.57.png" src="_images/phase_plot_100_12.57.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100_12.57.png"><img alt="_images/time_evo_100_12.57.png" src="_images/time_evo_100_12.57.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100 steps, end time 12.57.</p>
<p><a class="reference internal" href="_images/phase_plot_100_62.83.png"><img alt="_images/phase_plot_100_62.83.png" src="_images/phase_plot_100_62.83.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100_62.83.png"><img alt="_images/time_evo_100_62.83.png" src="_images/time_evo_100_62.83.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100 steps, end time 62.83.</p>
<p><a class="reference internal" href="_images/phase_plot_100_314.16.png"><img alt="_images/phase_plot_100_314.16.png" src="_images/phase_plot_100_314.16.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100_314.16.png"><img alt="_images/time_evo_100_314.16.png" src="_images/time_evo_100_314.16.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100 steps, end time 314.16.</p>
<p>1000 Steps</p>
<p><a class="reference internal" href="_images/phase_plot_1000_12.57.png"><img alt="_images/phase_plot_1000_12.57.png" src="_images/phase_plot_1000_12.57.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_1000_12.57.png"><img alt="_images/time_evo_1000_12.57.png" src="_images/time_evo_1000_12.57.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 1000 steps, end time 12.57.</p>
<p><a class="reference internal" href="_images/phase_plot_1000_62.83.png"><img alt="_images/phase_plot_1000_62.83.png" src="_images/phase_plot_1000_62.83.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_1000_62.83.png"><img alt="_images/time_evo_1000_62.83.png" src="_images/time_evo_1000_62.83.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 1000 steps, end time 62.83.</p>
<p><a class="reference internal" href="_images/phase_plot_1000_314.16.png"><img alt="_images/phase_plot_1000_314.16.png" src="_images/phase_plot_1000_314.16.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_1000_314.16.png"><img alt="_images/time_evo_1000_314.16.png" src="_images/time_evo_1000_314.16.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 1000 steps, end time 314.16.</p>
<ol class="arabic simple" start="2">
<li><p><strong>Medium step sizes (τ = 100, 1000)</strong><br />
As the time step decreases, the phase portraits become smoother and more symmetric. In the plots we can nicely see, that the explicit Euler Method increases in amplitude, while the implicit Euler Method decreases over time. This is especially noticable in the plots where the End Time is set to 314.16 seconds.</p></li>
</ol>
<p>10000 steps</p>
<p><a class="reference internal" href="_images/phase_plot_10000_12.57.png"><img alt="_images/phase_plot_10000_12.57.png" src="_images/phase_plot_10000_12.57.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10000_12.57.png"><img alt="_images/time_evo_10000_12.57.png" src="_images/time_evo_10000_12.57.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10000 steps, end time 12.57.</p>
<p><a class="reference internal" href="_images/phase_plot_10000_62.83.png"><img alt="_images/phase_plot_10000_62.83.png" src="_images/phase_plot_10000_62.83.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10000_62.83.png"><img alt="_images/time_evo_10000_62.83.png" src="_images/time_evo_10000_62.83.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10000 steps, end time 62.83.</p>
<p><a class="reference internal" href="_images/phase_plot_10000_314.16.png"><img alt="_images/phase_plot_10000_314.16.png" src="_images/phase_plot_10000_314.16.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_10000_314.16.png"><img alt="_images/time_evo_10000_314.16.png" src="_images/time_evo_10000_314.16.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 10000 steps, end time 314.16.</p>
<p>100000 steps</p>
<p><a class="reference internal" href="_images/phase_plot_100000_12.57.png"><img alt="_images/phase_plot_100000_12.57.png" src="_images/phase_plot_100000_12.57.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100000_12.57.png"><img alt="_images/time_evo_100000_12.57.png" src="_images/time_evo_100000_12.57.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100000 steps, end time 12.57.</p>
<p><a class="reference internal" href="_images/phase_plot_100000_62.83.png"><img alt="_images/phase_plot_100000_62.83.png" src="_images/phase_plot_100000_62.83.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100000_62.83.png"><img alt="_images/time_evo_100000_62.83.png" src="_images/time_evo_100000_62.83.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100000 steps, end time 62.83.</p>
<p><a class="reference internal" href="_images/phase_plot_100000_314.16.png"><img alt="_images/phase_plot_100000_314.16.png" src="_images/phase_plot_100000_314.16.png" style="width: 350px;" /></a> <a class="reference internal" href="_images/time_evo_100000_314.16.png"><img alt="_images/time_evo_100000_314.16.png" src="_images/time_evo_100000_314.16.png" style="width: 350px;" /></a></p>
<p>Phase portrait and time evolution for 100000 steps, end time 314.16.</p>
<ol class="arabic" start="3">
<li><p><strong>Very small step sizes (τ = 10000, 100000)</strong><br />
For the smallest step size considered, the phase curves converge toward the analytical solution.<br />
The trajectories become closed and circular, indicating stable long term behavior and good energy conservation. Altough on both plots with End Time = 314.16s, the explicit Euler Method again increases in Amplitude, showing that even at extremely small step sizes the method is not energy-preserving and accumulates a systematic energy error over long integration times.</p>
<h3 class="rubric" id="overall-conclusions">Overall Conclusions</h3>
</li>
</ol>
<p>As we can see in the plots, for very large τ, the waveform becomes visibly jagged. Even if we increase the number of steps, some time evolution plots show growing amplitude, others show damped amplitude, depending on the Numeric Method used. For example the explicit Euler method injects energy, therefore resulting in a growing amplitude. In contrast,the implicit Euler Method is both A-stable and L-stable. It has built in dampening, which dissipates energy and causes dampening over time.
The Crank-Nicholson Method is energy preserving, therefore the oscillations will continue without dampening or amplification.</p>
<p>For τ = 100000, the numerical time evolution is smooth and closely matches the expected sinusoidal behavior.  This demonstrates the expected convergence behavior of the integrators: as τ decreases, the numerical error shrinks at the rate predicted by the theoretical order of the method.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="nssc1-numerical-methods-for-ordinary-differential-equations-exercises-part-2">
<h1>NSSC1 Numerical Methods for Ordinary Differential Equations Exercises Part 2<a class="headerlink" href="#nssc1-numerical-methods-for-ordinary-differential-equations-exercises-part-2" title="Link to this heading">#</a></h1>
<a class="reference internal image-reference" href="_images/image.png"><img alt="_images/image.png" src="_images/image.png" style="width: 350px;" />
</a>
<section id="exercise-report-electric-network-simulation">
<h2>Exercise Report: Electric Network Simulation<a class="headerlink" href="#exercise-report-electric-network-simulation" title="Link to this heading">#</a></h2>
<section id="mathematical-model">
<h3>1. Mathematical Model<a class="headerlink" href="#mathematical-model" title="Link to this heading">#</a></h3>
<p>We model a simple RC circuit consisting of a resistor <span class="math notranslate nohighlight">\(R\)</span>, a capacitor <span class="math notranslate nohighlight">\(C\)</span>, and a time-dependent voltage source <span class="math notranslate nohighlight">\(U_0(t) = \cos(100 \pi t)\)</span>.</p>
<p>Using Ohm’s law (<span class="math notranslate nohighlight">\(U_R = R I\)</span>) and the capacitor equation (<span class="math notranslate nohighlight">\(I = C \dot{U}_C\)</span>), we apply Kirchhoff’s voltage law, which states that voltages around a loop sum to zero (<span class="math notranslate nohighlight">\(U_0 = U_R + U_C\)</span>). This yields the linear Ordinary Differential Equation (ODE):</p>
<div class="math notranslate nohighlight">
\[U_C(t) + RC \frac{dU_C}{dt}(t) = U_0(t)\]</div>
<p>Rearranging for the derivative, we obtain the standard non-autonomous form <span class="math notranslate nohighlight">\(\dot{y} = f(t, y)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{dU_C}{dt} = \frac{U_0(t) - U_C(t)}{RC} = \frac{\cos(100 \pi t) - U_C}{RC}\]</div>
</section>
<section id="transformation-to-autonomous-form">
<h3>2. Transformation to Autonomous Form<a class="headerlink" href="#transformation-to-autonomous-form" title="Link to this heading">#</a></h3>
<p>To utilize numerical solvers designed for autonomous systems (<span class="math notranslate nohighlight">\(\dot{\mathbf{y}} = F(\mathbf{y})\)</span>), we must eliminate the explicit time dependence. We achieve this by extending the state space to treat time as a dependent variable.</p>
<p>We define a new state vector <span class="math notranslate nohighlight">\(\mathbf{y} \in \mathbb{R}^2\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_1 = U_C\)</span> (Capacitor Voltage)</p></li>
<li><p><span class="math notranslate nohighlight">\(y_2 = t\)</span> (Time)</p></li>
</ul>
<p>The derivatives are formulated as follows:</p>
<ul class="simple">
<li><p><strong>Voltage:</strong> <span class="math notranslate nohighlight">\(\dot{y}_1 = \frac{U_0(y_2) - y_1}{RC}\)</span></p></li>
<li><p><strong>Time:</strong> <span class="math notranslate nohighlight">\(\dot{y}_2 = \frac{dt}{dt} = 1\)</span></p></li>
</ul>
<p>This results in the following autonomous system:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\dot{\mathbf{y}} = \begin{pmatrix} \frac{\cos(100 \pi y_2) - y_1}{RC} \\ 1 \end{pmatrix}\end{split}\]</div>
</section>
<section id="jacobian-for-implicit-methods">
<h3>3. Jacobian for Implicit Methods<a class="headerlink" href="#jacobian-for-implicit-methods" title="Link to this heading">#</a></h3>
<p>For the implementation of implicit solvers (Implicit Euler, Crank-Nicolson), the Jacobian matrix <span class="math notranslate nohighlight">\(J = \frac{\partial F}{\partial \mathbf{y}}\)</span> is required. Differentiating the system vector with respect to <span class="math notranslate nohighlight">\(y_1\)</span> and <span class="math notranslate nohighlight">\(y_2\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}J = \begin{pmatrix} 
\frac{\partial \dot{y}_1}{\partial y_1} &amp; \frac{\partial \dot{y}_1}{\partial y_2} \\
\frac{\partial \dot{y}_2}{\partial y_1} &amp; \frac{\partial \dot{y}_2}{\partial y_2}
\end{pmatrix} = 
\begin{pmatrix} 
-\frac{1}{RC} &amp; -\frac{100 \pi \sin(100 \pi y_2)}{RC} \\
0 &amp; 0
\end{pmatrix}\end{split}\]</div>
<p>The simulation uses this system with initial conditions <span class="math notranslate nohighlight">\(\mathbf{y}(0) = [0, 0]^T\)</span>.</p>
</section>
<section id="setup">
<h3>4. Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h3>
<p>When running the code 3 different stepping sizes have been used. <span class="math notranslate nohighlight">\(N = \{100, 1000, 10000\}\)</span>. And the two different model parameters <span class="math notranslate nohighlight">\(R=1, C=1\)</span> and <span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span>. As a total time 0.1 seconds were choosen. The results displayed in graphs can be found below. For each step size the resulting Capacity Voltage has been plotted for the 3 numerical methods: The explicit Euler, the implicit Euler and the Crank-Nicolson. The input voltage has been scaled to the the size of the capacity voltage, so that the phase shift can be nicely seen.</p>
<p><strong>Simulation Results</strong></p>
<a class="reference internal image-reference" href="_images/circuit_plot_100_1.png"><img alt="_images/circuit_plot_100_1.png" src="_images/circuit_plot_100_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 100 time steps and <span class="math notranslate nohighlight">\(R=1, C=1\)</span></em></p>
<a class="reference internal image-reference" href="_images/circuit_plot_1000_1.png"><img alt="_images/circuit_plot_1000_1.png" src="_images/circuit_plot_1000_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 1000 time steps and <span class="math notranslate nohighlight">\(R=1, C=1\)</span></em></p>
<a class="reference internal image-reference" href="_images/circuit_plot_10000_1.png"><img alt="_images/circuit_plot_10000_1.png" src="_images/circuit_plot_10000_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 10000 time steps and <span class="math notranslate nohighlight">\(R=1, C=1\)</span></em></p>
<a class="reference internal image-reference" href="_images/circuit_plot_100_1.png"><img alt="_images/circuit_plot_100_1.png" src="_images/circuit_plot_100_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 100 time steps and <span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span></em></p>
<a class="reference internal image-reference" href="_images/circuit_plot_1000_1.png"><img alt="_images/circuit_plot_1000_1.png" src="_images/circuit_plot_1000_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 1000 time steps and <span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span></em></p>
<a class="reference internal image-reference" href="_images/circuit_plot_10000_1.png"><img alt="_images/circuit_plot_10000_1.png" src="_images/circuit_plot_10000_1.png" style="width: 350px;" />
</a>
<p><em>Plot for 10000 time steps and <span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span></em></p>
</section>
</section>
<hr class="docutils" />
<section id="analysis-of-simulation-results">
<h2>Analysis of Simulation Results<a class="headerlink" href="#analysis-of-simulation-results" title="Link to this heading">#</a></h2>
<section id="part-1-r-100-c-10-6">
<h3>Part 1: (<span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span>)<a class="headerlink" href="#part-1-r-100-c-10-6" title="Link to this heading">#</a></h3>
<p><strong>1. Stiffness &amp; Stability Limits</strong></p>
<p>The system is stiff, characterized by a fast time constant <span class="math notranslate nohighlight">\(\tau = RC = 10^{-4}s\)</span> and a large negative eigenvalue <span class="math notranslate nohighlight">\(\lambda = -10000\)</span>.</p>
<ul class="simple">
<li><p><strong>Explicit Euler Stability Condition:</strong> <span class="math notranslate nohighlight">\(|1 + \lambda \Delta t| \le 1\)</span>.
For this system, stability requires <span class="math notranslate nohighlight">\(\Delta t \le 2 \cdot 10^{-4}s\)</span>.</p></li>
<li><p><strong>Implicit Method Stability:</strong> Implicit Euler and Crank-Nicolson are A-stable, meaning they remain stable for any step size <span class="math notranslate nohighlight">\(\Delta t\)</span>, regardless of <span class="math notranslate nohighlight">\(\tau\)</span>.</p></li>
</ul>
<p><strong>2. Method Behavior</strong></p>
<ul class="simple">
<li><p><strong>Explicit Euler</strong></p>
<ul>
<li><p><strong>100 Steps (<span class="math notranslate nohighlight">\(\Delta t = 10\tau\)</span>):</strong> Violates the stability condition (<span class="math notranslate nohighlight">\(10\tau &gt; 2\tau\)</span>). The solution explodes immediately, reaching physically impossible values (<span class="math notranslate nohighlight">\(10^{57}\)</span>).</p></li>
<li><p><strong>1000 Steps (<span class="math notranslate nohighlight">\(\Delta t = \tau\)</span>):</strong> Stable. Because <span class="math notranslate nohighlight">\(\Delta t = \tau\)</span>, the derivative projection lands exactly on the steady-state value in a single step (jumping from 0 to 1 instantly).</p></li>
</ul>
</li>
<li><p><strong>Implicit Euler</strong></p>
<ul>
<li><p><strong>Stable but Damped:</strong> Even with large steps (<span class="math notranslate nohighlight">\(10\tau\)</span>), the solution never explodes. However, it exhibits numerical damping, causing the voltage to lag behind the rapid initial changes.</p></li>
</ul>
</li>
<li><p><strong>Crank-Nicolson</strong></p>
<ul>
<li><p><strong>Stable but Oscillatory:</strong> Also stable for large steps (<span class="math notranslate nohighlight">\(10\tau\)</span>). However, it suffers from spurious oscillations (overshoot <span class="math notranslate nohighlight">\(&gt;1\)</span>) during the initial transient because it averages the derivatives at <span class="math notranslate nohighlight">\(t_n\)</span> and <span class="math notranslate nohighlight">\(t_{n+1}\)</span>, struggling to resolve the fast charge-up.</p></li>
</ul>
</li>
</ul>
</section>
<section id="part-2-system-r-1-c-1">
<h3>Part 2: System (<span class="math notranslate nohighlight">\(R=1, C=1\)</span>)<a class="headerlink" href="#part-2-system-r-1-c-1" title="Link to this heading">#</a></h3>
<p><strong>1. System Characteristics</strong></p>
<p>With the new parameters, the system dynamics change drastically:</p>
<ul class="simple">
<li><p>Time Constant: <span class="math notranslate nohighlight">\(\tau = RC = 1 \, s\)</span>.</p></li>
<li><p>Eigenvalue: <span class="math notranslate nohighlight">\(\lambda = -1\)</span>.</p></li>
<li><p>Stability Limit (Explicit): <span class="math notranslate nohighlight">\(|1 - \Delta t| \le 1 \Rightarrow \Delta t \le 2 \, s\)</span>.</p></li>
</ul>
<p>This system is non-stiff because the time constant (<span class="math notranslate nohighlight">\(\tau=1\)</span>) is much slower than the simulation time steps used (<span class="math notranslate nohighlight">\(10^{-3}\)</span> to <span class="math notranslate nohighlight">\(10^{-5}\)</span>).</p>
<p><strong>2. Stability Analysis</strong></p>
<p>Unlike the previous case, all methods are stable for all step sizes tested.
The largest step size used is <span class="math notranslate nohighlight">\(\Delta t = 0.001 \, s\)</span>.
Since <span class="math notranslate nohighlight">\(0.001 \ll 2\)</span> (the stability limit), Explicit Euler is well within its stability region.
<em>Observation:</em> No explosions or wild oscillations are observed.</p>
<p><strong>3. Physical Behavior: Low-Pass Filtering &amp; Phase Shift</strong></p>
<p>The circuit acts as a strong low-pass filter with significant phase lag.</p>
<ul class="simple">
<li><p><strong>Amplitude Attenuation:</strong>
Since the source frequency <span class="math notranslate nohighlight">\(\omega = 100\pi \approx 314\)</span> rad/s is much higher than the cutoff <span class="math notranslate nohighlight">\(\omega_c = 1\)</span> rad/s, the amplitude is attenuated by a factor of <span class="math notranslate nohighlight">\(\approx 1/314\)</span>. The data shows peaks around <span class="math notranslate nohighlight">\(0.003\)</span>V, matching this theory.</p></li>
<li><p><strong>Phase Shift (<span class="math notranslate nohighlight">\(\phi\)</span>):</strong>
The theoretical phase shift is <span class="math notranslate nohighlight">\(\phi = -\arctan(\omega RC) = -\arctan(314) \approx -89.8^\circ\)</span>.</p></li>
<li><p><strong>Observation in Data:</strong>
The voltage should lag the source by almost exactly <span class="math notranslate nohighlight">\(90^\circ\)</span> (<span class="math notranslate nohighlight">\(\pi/2\)</span>), which corresponds to a time lag of <span class="math notranslate nohighlight">\(0.005s\)</span> (quarter period). Looking at the graphs the capacitor voltage behaves like a Sine wave while the source is a Cosine wave, demonstrating the predicted <span class="math notranslate nohighlight">\(90^\circ\)</span> lag.</p></li>
</ul>
</section>
<section id="comparison-of-methods">
<h3>Comparison of Methods<a class="headerlink" href="#comparison-of-methods" title="Link to this heading">#</a></h3>
<p>Because the step sizes are small relative to the system time constant (<span class="math notranslate nohighlight">\(\Delta t \ll \tau\)</span>), the numerical errors are small for all methods.</p>
<ul class="simple">
<li><p><strong>Amplitude Discrepancy (Low N):</strong> At the coarsest resolution (100 steps), there is a distinct difference in amplitude due to numerical error properties.</p>
<ul>
<li><p>Explicit Euler overestimates the peak (<span class="math notranslate nohighlight">\(\approx 0.0036\)</span>V).</p></li>
<li><p>Crank-Nicolson sits in the middle (<span class="math notranslate nohighlight">\(\approx 0.0031\)</span>V).</p></li>
<li><p>Implicit Euler is the most damped and underestimates the peak (<span class="math notranslate nohighlight">\(\approx 0.0026\)</span>V).</p></li>
<li><p><em>Reason:</em> This occurs because Explicit Euler extrapolates linearly (overshooting convex curves), while Implicit Euler is numerically dissipative.</p></li>
</ul>
</li>
<li><p><strong>Resolution:</strong> Even the coarsest resolution (100 steps, <span class="math notranslate nohighlight">\(\Delta t = 0.001\)</span>) provides <span class="math notranslate nohighlight">\(\sim 20\)</span> points per period of the source (<span class="math notranslate nohighlight">\(T=0.02s\)</span>), sufficient to capture the general wave shape, though the amplitude accuracy varies by method as noted above.</p></li>
</ul>
</section>
<section id="summary-comparison">
<h3>Summary Comparison<a class="headerlink" href="#summary-comparison" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Parameter Set</p></th>
<th class="head text-left"><p>Time Constant <span class="math notranslate nohighlight">\(\tau\)</span></p></th>
<th class="head text-left"><p>System Type</p></th>
<th class="head text-left"><p>Explicit Euler (100 steps)</p></th>
<th class="head text-left"><p>Physical Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><strong>Set 1 (<span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span>)</strong></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(10^{-4} s\)</span></p></td>
<td class="text-left"><p>Stiff</p></td>
<td class="text-left"><p>Unstable (Explodes)</p></td>
<td class="text-left"><p>Fast charge (tracks source)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><strong>Set 2 (<span class="math notranslate nohighlight">\(R=1, C=1\)</span>)</strong></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(1 s\)</span></p></td>
<td class="text-left"><p>Non-Stiff</p></td>
<td class="text-left"><p>Stable</p></td>
<td class="text-left"><p>Filtered (Low amp, <span class="math notranslate nohighlight">\(90^\circ\)</span> lag)</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ElectricNetwork</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NonlinearFunction</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">R</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">C</span><span class="p">;</span><span class="w"> </span>

<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">ElectricNetwork</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">R</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimX</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimF</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluate</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">Uc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Uc</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">C</span><span class="p">);</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluateDeriv</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">MatrixView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">C</span><span class="p">);</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="mf">100.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">C</span><span class="p">);</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">df</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercise-18-4">
<h1>Exercise 18.4<a class="headerlink" href="#exercise-18-4" title="Link to this heading">#</a></h1>
<p>We can use automatic differentiation to compute the derivative of a function.<br />
In the first part of this exercise, we had to implement additional operators and functions for the <code class="docutils literal notranslate"><span class="pre">AutoDiff</span></code> class.</p>
<hr class="docutils" />
<section id="subtraction">
<h2>Subtraction<a class="headerlink" href="#subtraction" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">operator</span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The subtraction operator implements element-wise differentiation of the expression<br />
<span class="math notranslate nohighlight">\( a - b \)</span>. Because subtraction is linear, the derivative of the result is simply the difference of the individual derivatives, making this operator straightforward to implement.</p>
</section>
<hr class="docutils" />
<section id="division">
<h2>Division<a class="headerlink" href="#division" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">operator</span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">/</span>
<span class="w">            </span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The division operator computes both the value and derivative of the quotient $\frac{a}{b}$ using the quotient rule:</p>
<div class="math notranslate nohighlight">
\[ \frac{d}{dx_i}\!\left(\frac{a}{b}\right) = \frac{a_i' \, b - a\, b_i'}{b^2} \]</div>
<p>This allows automatic differentiation to propagate derivatives correctly through division.</p>
<p>These operators enable the evaluation and plotting of derivatives of the Legendre polynomials later in the exercise.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="additional-autodiff-functions">
<h1>Additional AutoDiff Functions<a class="headerlink" href="#additional-autodiff-functions" title="Link to this heading">#</a></h1>
<p>Below are the functions added to extend the mathematical capabilities of the <code class="docutils literal notranslate"><span class="pre">AutoDiff</span></code> class.</p>
<hr class="docutils" />
<section id="square">
<h2>Square<a class="headerlink" href="#square" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">square</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This function computes <span class="math notranslate nohighlight">\( a^2 \)</span> and uses the derivative<br />
<span class="math notranslate nohighlight">\( \frac{d}{dx}(a^2) = 2a\,a' \)</span>.<br />
It demonstrates how simple nonlinear operations can be expressed through the product rule.</p>
</section>
<hr class="docutils" />
<section id="square-root">
<h2>Square Root<a class="headerlink" href="#square-root" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The square root uses the derivative identity<br />
<span class="math notranslate nohighlight">\( \frac{d}{dx}\sqrt{a} = \frac{a'}{2\sqrt{a}} \)</span></p>
</section>
<hr class="docutils" />
<section id="cosine">
<h2>Cosine<a class="headerlink" href="#cosine" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="tangent">
<h2>Tangent<a class="headerlink" href="#tangent" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">sec2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">())</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sec2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Both the tan function and the cosine function were implemented practically identical to the sine function.</p>
</section>
<hr class="docutils" />
<section id="logarithm">
<h2>Logarithm<a class="headerlink" href="#logarithm" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The natural logarithm uses<br />
<span class="math notranslate nohighlight">\( \frac{d}{dx}\log(a) = \frac{a'}{a} \)</span></p>
</section>
<hr class="docutils" />
<section id="exponential">
<h2>Exponential<a class="headerlink" href="#exponential" title="Link to this heading">#</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="o">&gt;</span>
<span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The exponential function follows<br />
<span class="math notranslate nohighlight">\(
\frac{d}{dx} e^{a} = e^{a}\, a'
\)</span>.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="legendre-polynomials">
<h1>Legendre Polynomials<a class="headerlink" href="#legendre-polynomials" title="Link to this heading">#</a></h1>
<p>To evaluate Legendre polynomials and their derivatives up to order 5, we implemented a templated function <code class="docutils literal notranslate"><span class="pre">LegendrePolynomials</span></code> based on the standard recurrence relation</p>
<div class="math notranslate nohighlight">
\[
P_0(x) = 1, \qquad P_1(x) = x
\]</div>
<div class="math notranslate nohighlight">
\[
P_k(x) =
\frac{(2k-1)\,x\,P_{k-1}(x) - (k-1)\,P_{k-2}(x)}{k}
\]</div>
<p>We can see here how the implementation of additional of operators was required for the <code class="docutils literal notranslate"><span class="pre">AutoDiff</span></code> method to work, since the division and the subtraction operator are essential parts of the legendre polynomial.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;autodiff.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;legendre.hpp&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="n">ASC_ode</span><span class="o">::</span><span class="n">AutoDiff</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s">&quot;../results/legendre_output.csv&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,P&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,dP&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="w">        </span><span class="n">x</span><span class="p">.</span><span class="n">deriv</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>

<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">P</span><span class="p">;</span>
<span class="w">        </span><span class="n">LegendrePolynomials</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">);</span>

<span class="w">        </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">deriv</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Wrote legendre_output.csv (polynomials + derivatives)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the main program, each sample point <span class="math notranslate nohighlight">\( x \in [-1,1] \)</span> is represented as an <code class="docutils literal notranslate"><span class="pre">AutoDiff</span></code> variable with its derivative initialized to one. Passing this variable into the Legendre routine ensures that both <span class="math notranslate nohighlight">\( P_k(x) \)</span> and <span class="math notranslate nohighlight">\( \frac{dP_k}{dx} \)</span> are computed automatically through the recurrence. The LegendrePolynomials function then computes both the polynomial values and their exact derivatives at that point.</p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="results">
<h1>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h1>
<img alt="_images/legendre_output.png" src="_images/legendre_output.png" />
<p>The first plot shows the Legendre polynomials <span class="math notranslate nohighlight">\(P_0\)</span> through <span class="math notranslate nohighlight">\(P_5\)</span>. The higher order Polynomials exhibit increasing oscillatory behavior. They also all satisfy the boundary condition <span class="math notranslate nohighlight">\(P_n(1) = 1\)</span>. The overall symmetry properties are clearly visible: even polynomials are symmetric, whereas odd polynomials are asymmetric.</p>
<img alt="_images/legendre_output_derivative.png" src="_images/legendre_output_derivative.png" />
<p>The second plot shows the corresponding derivatives. Since differentiation lowers the polynomial degree by one, the derivative curves display fewer zero crossings and opposite parity: the derivative of an even Legendre polynomial is odd and vice versa.</p>
<p>Together, the two plots illustrate the structure of Legendre polynomials and demonstrate the effectiveness of automatic differentiation in propagating exact derivatives through a recursive definition.</p>
<section id="testing-of-the-autodiff-class-for-the-pendulum">
<h2>Testing of the AutoDiff Class for the Pendulum<a class="headerlink" href="#testing-of-the-autodiff-class-for-the-pendulum" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>1. Mathematical Model<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>The motion of a simple pendulum is described by the nonlinear second-order differential equation</p>
<div class="math notranslate nohighlight">
\[
\ddot{\alpha}(t) + \frac{g}{L}\sin(\alpha(t)) = 0,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha(t)\)</span> is the angular displacement, <span class="math notranslate nohighlight">\(L\)</span> the length of the pendulum, and <span class="math notranslate nohighlight">\(g\)</span> the gravitational acceleration.</p>
</section>
<section id="id2">
<h3>2. Transformation to Autonomous Form<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>To apply standard ODE solvers, the equation is rewritten as a first-order system. Introducing the angular velocity</p>
<div class="math notranslate nohighlight">
\[
\beta = \dot{\alpha},
\]</div>
<p>we obtain the autonomous system</p>
<div class="math notranslate nohighlight">
\[
\dot{\alpha} = \beta, \qquad
\dot{\beta} = -\frac{g}{L}\sin(\alpha).
\]</div>
<p>The right-hand side depends only on <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span>, so the system is written in autonomous form.</p>
</section>
<section id="automatic-differentiation">
<h3>3. Automatic Differentiation<a class="headerlink" href="#automatic-differentiation" title="Link to this heading">#</a></h3>
<p>Automatic differentiation is used to compute the derivatives needed for the Jacobian of the system. In automatic differentiation, each intermediate quantity carries both a value and its gradient. During computation, standard differentiation rules (product rule, chain rule, etc.) are applied automatically. This avoids choosing a finite-difference step size and yields derivative values that are exact up to machine precision.</p>
</section>
<section id="testing">
<h3>4. Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h3>
<p>To test the implementation of the pendulum model and the automatic differentiation mechanism, we wrote a simple <code class="docutils literal notranslate"><span class="pre">main</span></code> function that evaluates both the right-hand side of the ODE and its Jacobian at a chosen test point. We chose a pendulum with <span class="math notranslate nohighlight">\(L = 1.0\)</span> and <span class="math notranslate nohighlight">\(g = 9.81\)</span>, and evaluated the system at</p>
<div class="math notranslate nohighlight">
\[
\alpha = 0.5, \qquad \dot{\alpha} = 0.0.
\]</div>
<p>The program output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.70316</span><span class="p">)</span>

<span class="n">Df</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="mi">0</span> <span class="mi">1</span>
<span class="o">-</span><span class="mf">8.60908</span> <span class="mi">0</span>
</pre></div>
</div>
<p>The value<br />
<span class="math notranslate nohighlight">\(\dot{\beta} = -\frac{g}{L}\sin(0.5) \approx -4.70316\)</span><br />
matches the expected model.<br />
The Jacobian agrees with the analytical expression</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Df(\alpha,\beta) =
\begin{pmatrix}
0 &amp; 1 \\
-\frac{g}{L}\cos(\alpha) &amp; 0
\end{pmatrix},
\end{split}\]</div>
<p>since<br />
<span class="math notranslate nohighlight">\(-\frac{g}{L}\cos(0.5) \approx -8.60908\)</span>.</p>
<p>The agreement between the computed and theoretical values confirms that the automatic differentiation is working correctly and produces the expected derivatives.</p>
</section>
<hr class="docutils" />
<section id="id3">
<h3>5. Code<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span><span class="c1"> </span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;autodiff.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nonlinfunc.hpp&gt;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">ASC_ode</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PendulumAD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">NonlinearFunction</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">m_length</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">m_gravity</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">PendulumAD</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">gravity</span><span class="o">=</span><span class="mf">9.81</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_length</span><span class="p">(</span><span class="n">length</span><span class="p">),</span><span class="w"> </span><span class="n">m_gravity</span><span class="p">(</span><span class="n">gravity</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimX</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">dimF</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluate</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">T_evaluate</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">evaluateDeriv</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">MatrixView</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x_ad</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;</span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">f_ad</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="w">    </span><span class="n">x_ad</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="w">    </span><span class="n">x_ad</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">    </span><span class="n">T_evaluate</span><span class="o">&lt;</span><span class="n">AutoDiff</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">x_ad</span><span class="p">,</span><span class="w"> </span><span class="n">f_ad</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">         </span><span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f_ad</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">deriv</span><span class="p">()[</span><span class="n">j</span><span class="p">];</span>
<span class="w">  </span><span class="p">}</span>

<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="n">T_evaluate</span><span class="w"> </span><span class="p">(</span><span class="n">VectorView</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">VectorView</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">m_gravity</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">m_length</span><span class="p">;</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>
<span class="p">};</span>


<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">length</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">9.81</span><span class="p">;</span>

<span class="w">    </span><span class="n">PendulumAD</span><span class="w"> </span><span class="n">pend</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">gravity</span><span class="p">);</span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">alpha_dot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>

<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha</span><span class="p">;</span>
<span class="w">    </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alpha_dot</span><span class="p">;</span>

<span class="w">    </span><span class="n">pend</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x = (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;f(x) = (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">pend</span><span class="p">.</span><span class="n">evaluateDeriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Df(x):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">df</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runge-kutta-methods">
<h1>Runge Kutta Methods<a class="headerlink" href="#runge-kutta-methods" title="Link to this heading">#</a></h1>
<section id="exercise-19-4">
<h2>Exercise 19.4<a class="headerlink" href="#exercise-19-4" title="Link to this heading">#</a></h2>
<section id="testing-of-implicit-runge-kutta-methods">
<h3>Testing of Implicit Runge-Kutta Methods<a class="headerlink" href="#testing-of-implicit-runge-kutta-methods" title="Link to this heading">#</a></h3>
<p>The Implicit Runge-Kutta Methods utilize the <code class="docutils literal notranslate"><span class="pre">NewtonSolver</span></code> to solve a nonlinear system to calculate the next step. They all showcase both A stability, where increasing <span class="math notranslate nohighlight">\(τ\)</span> will not blow up the solution. The Gauss methods preserve the energy of the system while the Radau method introduces dampening.
Both methods are computationally more expensive than the Explicit Methods due to the Jacobian.</p>
<section id="graphs">
<h4>Graphs<a class="headerlink" href="#graphs" title="Link to this heading">#</a></h4>
<img alt="_images/implicit_error.png" src="_images/implicit_error.png" />
<img alt="_images/implicit_phase.png" src="_images/implicit_phase.png" />
<img alt="_images/implicit_time.png" src="_images/implicit_time.png" />
</section>
<section id="conclusion">
<h4>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h4>
<p>The Gauss2, Gauss3, and Radau IIA are all high order with Gauss-Legendre being <span class="math notranslate nohighlight">\(2s\)</span> where <span class="math notranslate nohighlight">\(s\)</span> is the number of stages, and Radau being <span class="math notranslate nohighlight">\(2s-1\)</span>. This meant that the global errors were very small compared to the amplitude, which is shown with the graphs overlapping almost perfectly. When zooming in, some differences can be noted but the differences is very small. These differences would be greater if the time steps became larger, or over a much longer time.</p>
</section>
</section>
<section id="implementation-of-explicit-runge-kutta-method">
<h3>Implementation of Explicit Runge-Kutta Method<a class="headerlink" href="#implementation-of-explicit-runge-kutta-method" title="Link to this heading">#</a></h3>
<p>The explicit Runge-Kutta Method was implemented in a class <code class="docutils literal notranslate"><span class="pre">ExplicitRungeKutta</span></code> which was able to store a general lower-triangular Butcher matrix <code class="docutils literal notranslate"><span class="pre">A</span></code> and vectors <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<p>This was then implemented wit the RK2 Method, the RK4 method and the Nyström method.</p>
<section id="id4">
<h4>Graphs<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<img alt="_images/explicit_error.png" src="_images/explicit_error.png" />
<img alt="_images/explicit_phase.png" src="_images/explicit_phase.png" />
<img alt="_images/explicit_time.png" src="_images/explicit_time.png" />
</section>
<section id="id5">
<h4>Conclusion<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p>The results showed that as the order increased, the Methods became more accurate with a smaller deviation from the Analytic Solution. They also showed that the answers were all more similar at the beginning and that the deviations were larger at the end. The order of accuracy also scaled with what order so the <code class="docutils literal notranslate"><span class="pre">RK2</span></code>  method had the largest error. The Nyström method had an error very similar to the implicit methods, so very low, but it alos is the most expensive per step. They are explicit methods, which means they are conditionally stable and as the step size increases they will eventually lose accuract and stability.</p>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercise-20-4-1-mass-spring-system">
<h1>Exercise 20.4.1 Mass-spring system<a class="headerlink" href="#exercise-20-4-1-mass-spring-system" title="Link to this heading">#</a></h1>
<p>We consider a mechanical system composed of point masses connected by springs and possibly fixed supports.</p>
<p>First, we extend the formulation by constraints using Lagrange multipliers. This allows us, for example, to enforce a fixed distance between two masses. For the implementation of the constraints the force evaluation in the simulation code is modified and the equations of motion are expanded by a constraint equation. The time integration scheme (Newmark method) remains unchanged.</p>
<p>Before we dive into the how the library can be used to simulate rigid body mechanics, we will go through the mathematical model, that makes up the foundation of this library.</p>
<hr class="docutils" />
<section id="original-mathematical-model">
<h2>1. Original Mathematical Model<a class="headerlink" href="#original-mathematical-model" title="Link to this heading">#</a></h2>
<section id="system-state">
<h3>System State<a class="headerlink" href="#system-state" title="Link to this heading">#</a></h3>
<p>We simulate <span class="math notranslate nohighlight">\(N\)</span> point masses in a space of dimension <span class="math notranslate nohighlight">\(D\)</span>.</p>
<p>The full position vector is</p>
<div class="math notranslate nohighlight">
\[
x \in \mathbb{R}^{n}, \qquad n = D \cdot N,
\]</div>
<p>Each mass <span class="math notranslate nohighlight">\(i\)</span> has position <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^D\)</span>, velocity <span class="math notranslate nohighlight">\(\dot{x}_i\)</span>, and acceleration <span class="math notranslate nohighlight">\(\ddot{x}_i\)</span>.</p>
</section>
<hr class="docutils" />
<section id="forces">
<h3>Forces<a class="headerlink" href="#forces" title="Link to this heading">#</a></h3>
<p>Each mass is subject to external and internal forces.</p>
<section id="gravity">
<h4>Gravity:<a class="headerlink" href="#gravity" title="Link to this heading">#</a></h4>
<div class="math notranslate nohighlight">
\[
F_i = m_i\, g.
\]</div>
</section>
<section id="spring-forces">
<h4>Spring Forces:<a class="headerlink" href="#spring-forces" title="Link to this heading">#</a></h4>
<p>For a spring between masses (i) and (j):</p>
<div class="math notranslate nohighlight">
\[
F_{ij}
=
k\bigl(\|x_i - x_j\| - L_0\bigr)\,
\frac{x_j - x_i}{\|x_j - x_i\|}.
\]</div>
<p>This contributes to the global force vector (F(x)).</p>
</section>
</section>
<hr class="docutils" />
<section id="equations-of-motion-unconstrained">
<h3>Equations of Motion (Unconstrained)<a class="headerlink" href="#equations-of-motion-unconstrained" title="Link to this heading">#</a></h3>
<p>Without constraints, the dynamics satisfy</p>
<div class="math notranslate nohighlight">
\[
M\ddot{x} = F(x),
\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(M\)</span> is diagonal matrix with masses on the diagonal,</p></li>
<li><p><span class="math notranslate nohighlight">\(F(x)\)</span> is the vector of applied forces.</p></li>
</ul>
<p>Thus the acceleration is</p>
<div class="math notranslate nohighlight">
\[
a(x) = M^{-1} F(x).
\]</div>
<p>This is the behavior implemented in <code class="docutils literal notranslate"><span class="pre">MSS_Function</span></code> when no constraints are added. The acceleration is what is given to the Newmark solver.</p>
</section>
</section>
<hr class="docutils" />
<section id="adding-constraints">
<h2>2. Adding Constraints<a class="headerlink" href="#adding-constraints" title="Link to this heading">#</a></h2>
<p>We now introduce a constraint of the form</p>
<div class="math notranslate nohighlight">
\[
g(x) = 0.
\]</div>
<p>These constraints modify the equations of motion.<br />
We introduce the Lagrangian as:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{L}(x,\lambda)
=
-U(x) + \lambda^T g(x).
\]</div>
<p>Differentiating yields a coupled system of two equations:</p>
<div class="math notranslate nohighlight">
\[
M\ddot{x}
=
-\frac{\partial U}{\partial x}
+
G(x)^{T}\lambda
\quad\text{(Modified Newton Equation)}
\]</div>
<div class="math notranslate nohighlight">
\[
g(x) = 0
\quad\text{(Constraint Equation)}
\]</div>
<hr class="docutils" />
<section id="example-distance-constraint">
<h3>Example: Distance Constraint<a class="headerlink" href="#example-distance-constraint" title="Link to this heading">#</a></h3>
<p>To enforce a distance constraint such that the distance between two masses <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> remains equal to some defined length <span class="math notranslate nohighlight">\(L_0\)</span>, <span class="math notranslate nohighlight">\(g(x)\)</span> is defined as follows:</p>
<div class="math notranslate nohighlight">
\[
g(x) = \|x_A - x_B\|^2 - L_0^2.
\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial g}{\partial x_A} = 2(x_A - x_B),
\qquad
\frac{\partial g}{\partial x_B} = -2(x_A - x_B).
\]</div>
<p>This is implemented in <code class="docutils literal notranslate"><span class="pre">DistanceConstraint</span></code>.</p>
</section>
</section>
<hr class="docutils" />
<section id="saddle-point-system-for-ddot-x-and-lambda">
<h2>3. Saddle-Point System for <span class="math notranslate nohighlight">\(\ddot{x}\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span><a class="headerlink" href="#saddle-point-system-for-ddot-x-and-lambda" title="Link to this heading">#</a></h2>
<p>Adding the constraints finally leads to the linear saddle-point system</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
M &amp; G^T \\
G &amp; 0
\end{pmatrix}
\begin{pmatrix}
\ddot{x} \\ \lambda
\end{pmatrix}
=
\begin{pmatrix}
F(x) \\ -g(x)
\end{pmatrix}.
\end{split}\]</div>
<p>Solving this system provides both:</p>
<ul class="simple">
<li><p>the <strong>accelerations</strong> <span class="math notranslate nohighlight">\(\ddot{x}\)</span>, needed by the Newmark solver,</p></li>
<li><p>the <strong>Lagrange multipliers</strong> <span class="math notranslate nohighlight">\(\lambda\)</span>, enforcing the constraint.</p></li>
</ul>
<p>To avoid modifying the Newmark solver, the linear saddle-point system is solved using a linear solver from the Eigen library. Only the accelerations <span class="math notranslate nohighlight">\(\ddot{x}\)</span> are then passed to the Newmark time-integration method, while the multipliers <span class="math notranslate nohighlight">\(\lambda\)</span> are used internally to enforce the constraint.</p>
</section>
<hr class="docutils" />
<section id="analytic-derivative-of-acceleration">
<h2>4. Analytic Derivative of Acceleration<a class="headerlink" href="#analytic-derivative-of-acceleration" title="Link to this heading">#</a></h2>
<p>The C++ function <code class="docutils literal notranslate"><span class="pre">evaluateDeriv</span></code> computes the Jacobian to solve a mass-spring system for both constrainted and unconstrained cases:</p>
<div class="math notranslate nohighlight">
\[
J = \frac{\partial \ddot{x}}{\partial x}
\]</div>
<hr class="docutils" />
<section id="spring-contribution-k-text-spring">
<h3>4.1 Spring Contribution (<span class="math notranslate nohighlight">\(K_\text{spring}\)</span>)<a class="headerlink" href="#spring-contribution-k-text-spring" title="Link to this heading">#</a></h3>
<p>For each spring connecting points <span class="math notranslate nohighlight">\(p_1, p_2\)</span>  with stiffness <span class="math notranslate nohighlight">\(k\)</span> and the length of the string at rest defined as <span class="math notranslate nohighlight">\(\ell\)</span>, the code defines the current length <span class="math notranslate nohighlight">\(d = \|p_2 - p_1\|\)</span> and unit direction <span class="math notranslate nohighlight">\(\text{dir} = (p_2 - p_1)/d\)</span>.</p>
<p>The local stiffness scalars are defined as:</p>
<div class="math notranslate nohighlight">
\[
k_e = k, \qquad k_g = k\left(1 - \frac{\ell}{d}\right).
\]</div>
<p>These are used to compute the local matrix:</p>
<div class="math notranslate nohighlight">
\[
K_\text{loc} = k_g I_D + (k_e - k_g)\,\text{dir}\,\text{dir}^\top.
\]</div>
<p>The global matrix <span class="math notranslate nohighlight">\(K_\text{spring} \in \mathbb{R}^{n_\text{dof} \times n_\text{dof}}\)</span> is assembled by adding <span class="math notranslate nohighlight">\(-K_\text{loc}\)</span> to the diagonal blocks of the connected masses and <span class="math notranslate nohighlight">\(+K_\text{loc}\)</span> to the off-diagonal blocks, yielding:</p>
<div class="math notranslate nohighlight">
\[
K_\text{spring} = \frac{\partial F_\text{spring}}{\partial x}(x).
\]</div>
</section>
<hr class="docutils" />
<section id="unconstrained-case">
<h3>4.2 Unconstrained Case<a class="headerlink" href="#unconstrained-case" title="Link to this heading">#</a></h3>
<p>If there are no constraints (<span class="math notranslate nohighlight">\(m = 0\)</span>), with <span class="math notranslate nohighlight">\(m\)</span> being the number of constraints, the equations of motion are defined as:</p>
<div class="math notranslate nohighlight">
\[
M \ddot{x} = F(x) \quad\Rightarrow\quad \ddot{x}(x) = M^{-1} F(x).
\]</div>
<p>Therefore, the Jacobian is computed by row-wise division of <span class="math notranslate nohighlight">\(K_\text{spring}\)</span> by the corresponding masses:</p>
<div class="math notranslate nohighlight">
\[
J = \frac{\partial \ddot{x}}{\partial x} = M^{-1} K_\text{spring}.
\]</div>
</section>
<hr class="docutils" />
<section id="constrained-case">
<h3>4.3 Constrained Case<a class="headerlink" href="#constrained-case" title="Link to this heading">#</a></h3>
<p>If constraints exist, the function builds the KKT matrix <span class="math notranslate nohighlight">\(AE\)</span>, where <span class="math notranslate nohighlight">\(M\)</span> is the diagonal mass matrix and <span class="math notranslate nohighlight">\(G\)</span> is the constraint Jacobian:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
AE = \begin{pmatrix} M &amp; G^\top \\ G &amp; 0 \end{pmatrix}.
\end{split}\]</div>
<p>The system solves for the total Jacobian <span class="math notranslate nohighlight">\(J_{\text{total}}\)</span> using a right-hand side composed of <span class="math notranslate nohighlight">\(K_\text{spring}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix} M &amp; G^\top \\ G &amp; 0 \end{pmatrix} \begin{pmatrix} J \\ J_\lambda \end{pmatrix} = \begin{pmatrix} K_\text{spring} \\ 0 \end{pmatrix}.
\end{split}\]</div>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h1>
<p>In this section, the four different physical systems modeled and simulated using the library are presented</p>
<ol class="arabic simple">
<li><p>A <strong>Double Pendulum</strong></p></li>
<li><p>A <strong>Chain Pendulum</strong></p></li>
<li><p>A <strong>Crane Structure</strong></p></li>
<li><p>A <strong>Spinning Top</strong></p></li>
</ol>
<p>Out of these four systems, <strong>two make use of the newly implemented constraint formulation</strong>:<br />
the <strong>Double Pendulum</strong> and the <strong>Spinning Top</strong>.</p>
<hr class="docutils" />
<section id="double-pendulum">
<h2>Double Pendulum<a class="headerlink" href="#double-pendulum" title="Link to this heading">#</a></h2>
<p>In this example, two masses are connected in a pendulum-like configuration, both a spring-based and a constraint-based formulation are implemented.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp"># for a 2 mass pendulum</span>
<span class="n">mss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MassSpringSystem3d</span><span class="p">()</span>
<span class="n">mss</span><span class="p">.</span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">-9.81</span><span class="p">)</span>
<span class="n">mA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">mB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">200000</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="n">mA</span><span class="p">)))</span>
<span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">mA</span><span class="p">,</span><span class="w"> </span><span class="n">mB</span><span class="p">)))</span>
</pre></div>
</div>
<video width="600" controls>
  <source src="_static/double_pendulum.mp4" type="video/mp4">
</video>
<p>This render shows the double pendulum in its spring-based formulation.</p>
<section id="double-pendulum-with-the-constraint-based-formulation">
<h3>Double Pendulum with the constraint-based formulation<a class="headerlink" href="#double-pendulum-with-the-constraint-based-formulation" title="Link to this heading">#</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp"># Create System</span>
<span class="n">mss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MassSpringSystem3d</span><span class="p">()</span>
<span class="n">mss</span><span class="p">.</span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">-9.81</span><span class="p">)</span>

<span class="n">pivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>

<span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)))</span>
<span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)))</span>

<span class="n">ndof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">)</span>

<span class="n">mss</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">DistanceConstraint3d</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span><span class="w"> </span><span class="n">pivot</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">mss</span><span class="p">))</span>

<span class="n">mss</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">DistanceConstraint3d</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">mss</span><span class="p">))</span>
</pre></div>
</div>
<video width="600" controls>
  <source src="_static/double_pendulum_constrained.mp4" type="video/mp4">
</video>
<p>The <strong>difference in numerical stability and oscillation behavior between both formulations can be clearly observed in the provided Python notebook</strong>.</p>
</section>
</section>
<hr class="docutils" />
<section id="chain-pendulum">
<h2>Chain Pendulum<a class="headerlink" href="#chain-pendulum" title="Link to this heading">#</a></h2>
<p>This example models a flexible chain consisting of multiple masses connected by springs and fixed at one end.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MassSpringSystem3d</span><span class="p">()</span>
<span class="n">mss</span><span class="p">.</span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">-9.81</span><span class="p">)</span>

<span class="n">use_constraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">True</span>

<span class="n">number_of_masses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="n">starting_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">length_chain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="n">single_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length_chain</span><span class="o">/</span><span class="n">number_of_masses</span>

<span class="n">prev_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">(</span><span class="n">starting_position</span><span class="p">))</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">number_of_masses</span><span class="p">)</span><span class="o">:</span>
<span class="w">     </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">starting_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">single_length</span><span class="p">,</span>
<span class="w">            </span><span class="n">starting_position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="w">            </span><span class="n">starting_position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="w">     </span><span class="n">new_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">))</span>
<span class="w">     </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">prev_obj</span><span class="p">,</span><span class="w"> </span><span class="n">new_mass</span><span class="p">)))</span>
<span class="w">     </span><span class="n">prev_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_mass</span>
</pre></div>
</div>
<video width="600" controls>
  <source src="_static/chain.mp4" type="video/mp4">
</video>
<p>The chain is fixed at its left end and swings freely under the influence of gravity. This system is modeled purely using springs and does not use the new constraint formulation.</p>
</section>
<hr class="docutils" />
<section id="crane">
<h2>Crane<a class="headerlink" href="#crane" title="Link to this heading">#</a></h2>
<p>This example simulates a flexible crane structure constructed from a truss-like network of stiff springs and a heavy load at the tip.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MassSpringSystem3d</span><span class="p">()</span>
<span class="n">mss</span><span class="p">.</span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">-9.81</span><span class="p">)</span>

<span class="n">num_bays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w">        </span>
<span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">           </span>
<span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">          </span>
<span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">          </span>
<span class="n">stiffness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50000</span><span class="w">     </span>

<span class="n">cable_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w">       </span>
<span class="n">load_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">50.0</span><span class="w">      </span>

<span class="n">diag_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">height</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cable_diag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">math</span><span class="p">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cable_len</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p_bl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w">          </span>
<span class="n">p_br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w">      </span>
<span class="n">p_tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">)))</span><span class="w"> </span>
<span class="n">p_tl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">)))</span><span class="w">     </span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">num_bays</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">length</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">c_bl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w">         </span>
<span class="w">    </span><span class="n">c_br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span><span class="w">      </span>
<span class="w">    </span><span class="n">c_tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">c_tl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">)))</span><span class="w">    </span>

<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_bl</span><span class="p">,</span><span class="w"> </span><span class="n">c_bl</span><span class="p">)))</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_br</span><span class="p">,</span><span class="w"> </span><span class="n">c_br</span><span class="p">)))</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_tr</span><span class="p">,</span><span class="w"> </span><span class="n">c_tr</span><span class="p">)))</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_tl</span><span class="p">,</span><span class="w"> </span><span class="n">c_tl</span><span class="p">)))</span>

<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w">  </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">c_bl</span><span class="p">,</span><span class="w"> </span><span class="n">c_br</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">c_br</span><span class="p">,</span><span class="w"> </span><span class="n">c_tr</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w">  </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">c_tr</span><span class="p">,</span><span class="w"> </span><span class="n">c_tl</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">c_tl</span><span class="p">,</span><span class="w"> </span><span class="n">c_bl</span><span class="p">)))</span><span class="w"> </span>

<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">diag_len</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_bl</span><span class="p">,</span><span class="w"> </span><span class="n">c_tl</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">diag_len</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_br</span><span class="p">,</span><span class="w"> </span><span class="n">c_tr</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">diag_len</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_tl</span><span class="p">,</span><span class="w"> </span><span class="n">c_tr</span><span class="p">)))</span><span class="w"> </span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">diag_len</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_bl</span><span class="p">,</span><span class="w"> </span><span class="n">c_br</span><span class="p">)))</span><span class="w"> </span>

<span class="w">    </span><span class="n">p_bl</span><span class="p">,</span><span class="w"> </span><span class="n">p_br</span><span class="p">,</span><span class="w"> </span><span class="n">p_tr</span><span class="p">,</span><span class="w"> </span><span class="n">p_tl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c_bl</span><span class="p">,</span><span class="w"> </span><span class="n">c_br</span><span class="p">,</span><span class="w"> </span><span class="n">c_tr</span><span class="p">,</span><span class="w"> </span><span class="n">c_tl</span>

<span class="n">tip_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_bays</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">length</span>
<span class="n">load_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span>
<span class="n">load_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cable_len</span>

<span class="n">load_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="n">load_mass</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">tip_x</span><span class="p">,</span><span class="w"> </span><span class="n">load_y</span><span class="p">,</span><span class="w"> </span><span class="n">load_z</span><span class="p">)))</span>

<span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">cable_diag</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_tl</span><span class="p">,</span><span class="w"> </span><span class="n">load_node</span><span class="p">)))</span>
<span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Spring</span><span class="p">(</span><span class="n">cable_diag</span><span class="p">,</span><span class="w"> </span><span class="n">stiffness</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">p_tr</span><span class="p">,</span><span class="w"> </span><span class="n">load_node</span><span class="p">)))</span>
</pre></div>
</div>
<video width="600" controls>
  <source src="_static/crane.mp4" type="video/mp4">
</video>
<p>The single mass at the lower right represents the load with a mass of 50 units, while all other masses have unit mass. The crane is fixed on the left side and bends under the applied gravitational load.</p>
</section>
<hr class="docutils" />
<section id="spinning-top">
<h2>Spinning Top<a class="headerlink" href="#spinning-top" title="Link to this heading">#</a></h2>
<p>This example models a rigid spinning top using three mass nodes and a fixed pivot. Distance constraints are used to enforce rigid body behavior, making this the second system that relies on the newly implemented constraint formulation.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MassSpringSystem3d</span><span class="p">()</span>
<span class="n">mss</span><span class="p">.</span><span class="n">gravity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">-9.81</span><span class="p">)</span>

<span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">          </span>
<span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">          </span>
<span class="n">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="w">     </span>
<span class="n">mass_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w">   </span>
<span class="n">tilt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="w">      </span>

<span class="n">pivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Fix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>

<span class="n">mass_nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="n">angles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">]</span>

<span class="k">for</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">angles</span><span class="o">:</span>
<span class="w">    </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tilt</span>
<span class="w">    </span><span class="n">py</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="w">    </span><span class="n">pz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span>
<span class="w">    </span><span class="n">m_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mss</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">Mass</span><span class="p">(</span><span class="n">mass_val</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="n">pz</span><span class="p">)))</span>
<span class="w">    </span><span class="n">mass_nodes</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_node</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">rel_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tilt</span>
<span class="w">    </span><span class="n">rel_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">[</span><span class="n">m_node</span><span class="p">.</span><span class="n">nr</span><span class="p">].</span><span class="n">vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="n">omega</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rel_y</span><span class="p">,</span><span class="w"> </span><span class="n">omega</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rel_x</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">]</span>

<span class="n">ndof</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">)</span>

<span class="k">for</span><span class="w"> </span><span class="n">m_node</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">mass_nodes</span><span class="o">:</span>
<span class="w">    </span><span class="n">p_pivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">fixes</span><span class="p">[</span><span class="n">pivot</span><span class="p">.</span><span class="n">nr</span><span class="p">].</span><span class="n">pos</span><span class="p">)</span>
<span class="w">    </span><span class="n">p_mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">[</span><span class="n">m_node</span><span class="p">.</span><span class="n">nr</span><span class="p">].</span><span class="n">pos</span><span class="p">)</span>
<span class="w">    </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p_mass</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_pivot</span><span class="p">)</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">DistanceConstraint3d</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span><span class="w"> </span><span class="n">pivot</span><span class="p">,</span><span class="w"> </span><span class="n">m_node</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="p">,</span><span class="w"> </span><span class="n">mss</span><span class="p">))</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">mass_nodes</span><span class="p">))</span><span class="o">:</span>
<span class="w">    </span><span class="n">nA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mass_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="w">    </span><span class="n">nB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mass_nodes</span><span class="p">[(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span>
<span class="w">    </span><span class="n">pA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">[</span><span class="n">nA</span><span class="p">.</span><span class="n">nr</span><span class="p">].</span><span class="n">pos</span><span class="p">)</span>
<span class="w">    </span><span class="n">pB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">mss</span><span class="p">.</span><span class="n">masses</span><span class="p">[</span><span class="n">nB</span><span class="p">.</span><span class="n">nr</span><span class="p">].</span><span class="n">pos</span><span class="p">)</span>
<span class="w">    </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pA</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pB</span><span class="p">)</span>
<span class="w">    </span><span class="n">mss</span><span class="p">.</span><span class="n">addConstraint</span><span class="p">(</span><span class="n">DistanceConstraint3d</span><span class="p">(</span><span class="n">ndof</span><span class="p">,</span><span class="w"> </span><span class="n">nA</span><span class="p">,</span><span class="w"> </span><span class="n">nB</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="p">,</span><span class="w"> </span><span class="n">mss</span><span class="p">))</span>
</pre></div>
</div>
<video width="600" controls>
  <source src="_static/spinning_top.mp4" type="video/mp4">
</video>
<p>The three rotating masses form a rigid triangular structure connected to the pivot by distance constraints. The initial angular velocity defines the spin of the top, and the constraints ensure that the geometric structure remains rigid throughout the simulation.</p>
<hr class="docutils" />
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">NSSC1 Numerical Methods for Ordinary Differential Equations Exercises</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#explicit-euler-method">Explicit Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#implicit-euler-method">Implicit Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-euler-method">Improved Euler Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#crank-nicolson-method">Crank-Nicolson Method</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-plots">Interpretation of Plots</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#nssc1-numerical-methods-for-ordinary-differential-equations-exercises-part-2">NSSC1 Numerical Methods for Ordinary Differential Equations Exercises Part 2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-report-electric-network-simulation">Exercise Report: Electric Network Simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mathematical-model">1. Mathematical Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-to-autonomous-form">2. Transformation to Autonomous Form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jacobian-for-implicit-methods">3. Jacobian for Implicit Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">4. Setup</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-simulation-results">Analysis of Simulation Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-r-100-c-10-6">Part 1: (<span class="math notranslate nohighlight">\(R=100, C=10^{-6}\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-system-r-1-c-1">Part 2: System (<span class="math notranslate nohighlight">\(R=1, C=1\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-of-methods">Comparison of Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-comparison">Summary Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">Code</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-18-4">Exercise 18.4</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subtraction">Subtraction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#division">Division</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-autodiff-functions">Additional AutoDiff Functions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#square">Square</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#square-root">Square Root</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cosine">Cosine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tangent">Tangent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#logarithm">Logarithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exponential">Exponential</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#legendre-polynomials">Legendre Polynomials</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-of-the-autodiff-class-for-the-pendulum">Testing of the AutoDiff Class for the Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1. Mathematical Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2. Transformation to Autonomous Form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-differentiation">3. Automatic Differentiation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">4. Testing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">5. Code</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#runge-kutta-methods">Runge Kutta Methods</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-19-4">Exercise 19.4</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-of-implicit-runge-kutta-methods">Testing of Implicit Runge-Kutta Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#graphs">Graphs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-explicit-runge-kutta-method">Implementation of Explicit Runge-Kutta Method</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Graphs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-20-4-1-mass-spring-system">Exercise 20.4.1 Mass-spring system</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#original-mathematical-model">1. Original Mathematical Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-state">System State</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forces">Forces</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gravity">Gravity:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-forces">Spring Forces:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equations-of-motion-unconstrained">Equations of Motion (Unconstrained)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-constraints">2. Adding Constraints</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-distance-constraint">Example: Distance Constraint</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saddle-point-system-for-ddot-x-and-lambda">3. Saddle-Point System for <span class="math notranslate nohighlight">\(\ddot{x}\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytic-derivative-of-acceleration">4. Analytic Derivative of Acceleration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spring-contribution-k-text-spring">4.1 Spring Contribution (<span class="math notranslate nohighlight">\(K_\text{spring}\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unconstrained-case">4.2 Unconstrained Case</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constrained-case">4.3 Constrained Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#double-pendulum">Double Pendulum</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-pendulum-with-the-constraint-based-formulation">Double Pendulum with the constraint-based formulation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chain-pendulum">Chain Pendulum</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crane">Crane</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spinning-top">Spinning Top</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Carina Meinke, Timur Demerci, Gregor Samonig, Simon Wollendorfer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>